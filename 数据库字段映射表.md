# 数据库字段映射表

本文档提供所有数据库表的中英文字段对照，便于开发时快速查阅。

---

## 货币与汇率设计说明

### 核心设计原则

本系统采用**混合货币存储**策略：

- **进货阶段**：以人民币(CNY)为记账单位
- **库存/订单阶段**：以日元(JPY)为记账单位
- **汇率转换点**：在库存录入时完成一次性转换

### 数据流转过程

```
1. 进货录入（人民币）
   ├─ 手动输入：人民币支出金额（如 ¥1000）
   ├─ 获取汇率：CNY→JPY（如 1:20.5，表示1元人民币=20.5日元）
   └─ 存储：total_amount(CNY), exchange_rate

2. 库存录入（双币种支持）
   ├─ 场景A：人民币进货 (currency_type = "CNY")
   │  ├─ 显示：进货总额(CNY) 和 对应日元总额(JPY)
   │  ├─ 输入：用户分配各商品的人民币金额
   │  ├─ 转换：purchase_amount(JPY) = purchase_amount_cny × exchange_rate
   │  ├─ 计算：unit_cost(JPY) = purchase_amount(JPY) ÷ quantity
   │  ├─ 存储：purchase_amount_cny + purchase_amount + unit_cost
   │  └─ 验证：Σ purchase_amount_cny = total_amount(CNY)
   │
   └─ 场景B：日元进货 (currency_type = "JPY")
      ├─ 显示：进货总额(JPY)
      ├─ 输入：用户分配各商品的日元金额（人民币框禁用）
      ├─ 计算：unit_cost(JPY) = purchase_amount(JPY) ÷ quantity
### 设计优势

1. **汇率一致性**：同一进货单的所有商品使用统一汇率（存储在进货表中）
2. **成本可见性**：库存直接显示日元成本，符合销售业务习惯
3. **计算简洁性**：订单利润计算无需实时汇率转换
4. **验证可靠性**：库存录入时即完成总额验证，数据一致性高
5. **双币种支持**：同时支持人民币和日元进货，灵活应对不同采购场景
6. **数据真实性**：人民币进货保留原始金额，日元进货避免不必要的逆向转换
   └─ 利润：日元收入 - 日元成本
```

### 设计优势

1. **汇率一致性**：同一进货单的所有商品使用统一汇率（存储在进货表中）
2. **成本可见性**：库存直接显示日元成本，符合销售业务习惯
3. **计算简洁性**：订单利润计算无需实时汇率转换
4. **验证可靠性**：库存录入时即完成总额验证，数据一致性高

---

## 1. 商品分类表 (categories)

| 中文字段   | 英文字段   | 类型         |
| ---------- | ---------- | ------------ |
| id         | id         | INT          |
| 分类名     | name       | VARCHAR(100) |
| 创建时间   | created_at | DATETIME     |
| 更新时间   | updated_at | DATETIME     |
| 软删除标记 | is_deleted | BOOLEAN      |

## 2. 进货渠道表 (suppliers)

| 中文字段   | 英文字段   | 类型         |
| ---------- | ---------- | ------------ |
| id         | id         | INT          |
| 渠道名     | name       | VARCHAR(100) |
| 创建时间   | created_at | DATETIME     |
| 更新时间   | updated_at | DATETIME     |
| 软删除标记 | is_deleted | BOOLEAN      |

## 3. 商品表 (products)

| 中文字段   | 英文字段    | 类型         |
| ---------- | ----------- | ------------ |
| id         | id          | INT          |
| 分类 id    | category_id | INT          |
| 品名       | name        | VARCHAR(200) |
| 创建时间   | created_at  | DATETIME     |
| 更新时间   | updated_at  | DATETIME     |
| 软删除标记 | is_deleted  | BOOLEAN      |

## 4. 进货表 (purchases)

| 中文字段    | 英文字段      | 类型          | 说明                                |
| ----------- | ------------- | ------------- | ----------------------------------- |
| id          | id            | INT           |                                     |
| 进货渠道 id | supplier_id   | INT           |                                     |
| 进货日期    | purchase_date | DATE          |                                     |
| 进货单号    | purchase_no   | VARCHAR(100)  |                                     |
| 支出        | total_amount  | DECIMAL(15,2) | 手动输入                            |
| 货币类型    | currency_type | VARCHAR(10)   | 货币类型（"JPY" or "CNY"）          |
| 汇率        | exchange_rate | DECIMAL(10,4) | **CNY→JPY**，用于库存录入时统一转换 |
| 创建时间    | created_at    | DATETIME      |                                     |
| 更新时间    | updated_at    | DATETIME      |                                     |
| 软删除标记  | is_deleted    | BOOLEAN       |                                     |

## 5. 在库表 (inventory)

| 中文字段         | 英文字段            | 类型          | 说明                                        |
| ---------------- | ------------------- | ------------- | ------------------------------------------- |
| id               | id                  | INT           |                                             |
| 商品 id          | product_id          | INT           |                                             |
| 进货 id          | purchase_id         | INT           |                                             |
| 进货支出(日元)   | purchase_amount     | DECIMAL(15,2) | **日元(JPY)**，必填                         |
| 进货支出(人民币) | purchase_amount_cny | DECIMAL(15,2) | **人民币(CNY)**，可空，仅人民币进货时填写   |
| 进货数量         | purchase_quantity   | INT           |                                             |
| 单件成本         | unit_cost           | DECIMAL(15,2) | **日元(JPY)**，= purchase_amount ÷ quantity |
| 在库数量         | stock_quantity      | INT           |                                             |
| 创建时间         | created_at          | DATETIME      |                                             |
| 更新时间         | updated_at          | DATETIME      |                                             |
| 软删除标记       | is_deleted          | BOOLEAN       |                                             |

### 库存录入规则

#### 场景 1：人民币进货 (currency_type = "CNY")

1. **输入方式**：用户输入人民币金额
2. **自动转换**：`purchase_amount(JPY) = purchase_amount_cny × exchange_rate`
3. **成本计算**：`unit_cost = purchase_amount(JPY) ÷ purchase_quantity`
4. **存储内容**：
   - `purchase_amount_cny`：用户输入的人民币金额
   - `purchase_amount`：自动计算的日元金额
   - `unit_cost`：日元单位成本

#### 场景 2：日元进货 (currency_type = "JPY")

1. **输入方式**：用户输入日元金额，人民币输入框禁用
2. **成本计算**：`unit_cost = purchase_amount(JPY) ÷ purchase_quantity`
3. **存储内容**：
   - `purchase_amount_cny`：0
   - `purchase_amount`：用户输入的日元金额
   - `unit_cost`：日元单位成本

#### 初始化行为

- 首次录入库存明细时，自动将进货表的 `total_amount` 填充到空白行对应的输入框
- 根据 `currency_type` 决定填充到人民币输入框还是日元输入框

## 6. 订单表 (orders)

| 中文字段   | 英文字段         | 类型          | 说明                               |
| ---------- | ---------------- | ------------- | ---------------------------------- |
| id         | id               | INT           |                                    |
| 订单编号   | order_no         | VARCHAR(100)  |                                    |
| 图片 url   | image_url        | VARCHAR(500)  |                                    |
| 收入金额   | revenue          | DECIMAL(15,2) | **日元(JPY)**                      |
| 成本       | total_cost       | DECIMAL(15,2) | **日元(JPY)**                      |
| 运费       | shipping_fee     | DECIMAL(15,2) | **日元(JPY)**，从 Mercari API 读取 |
| 交易时间   | transaction_time | DATETIME      |                                    |
| 创建时间   | created_at       | DATETIME      |                                    |
| 更新时间   | updated_at       | DATETIME      |                                    |
| 软删除标记 | is_deleted       | BOOLEAN       |                                    |

## 7. 订单详细表 (order_details)

| 中文字段   | 英文字段       | 类型          | 说明                        |
| ---------- | -------------- | ------------- | --------------------------- |
| id         | id             | INT           |                             |
| 订单 id    | order_id       | INT           |                             |
| 在库 id    | inventory_id   | INT           |                             |
| 商品 id    | product_id     | INT           |                             |
| 出库单价   | unit_price     | DECIMAL(15,2) | **日元(JPY)**，销售单价     |
| 数量       | quantity       | INT           |                             |
| 包装成本   | packaging_cost | DECIMAL(15,2) | **日元(JPY)**               |
| 其他成本   | other_cost     | DECIMAL(15,2) | **日元(JPY)**               |
| 小计成本   | subtotal_cost  | DECIMAL(15,2) | **日元(JPY)**，引用库存成本 |
| 备注       | notes          | TEXT          |                             |
| 创建时间   | created_at     | DATETIME      |                             |
| 更新时间   | updated_at     | DATETIME      |                             |
| 软删除标记 | is_deleted     | BOOLEAN       |                             |

---

## 命名规范说明

### 表名规范

- 使用复数形式的英文名词
- 全小写，多词用下划线连接
- 例如：`categories`, `suppliers`, `products`

### 字段名规范

- 使用蛇形命名法 (snake_case)
- 外键使用 `表名单数_id` 格式，如 `category_id`, `product_id`
- 金额相关字段使用 `_amount` 或 `_cost` 后缀
- 数量字段使用 `_quantity` 后缀
- 时间字段使用 `_at` 或 `_time` 后缀
- 布尔字段使用 `is_` 前缀

### 通用字段

所有表都包含以下标准字段：

- `id`: 主键
- `created_at`: 创建时间
- `updated_at`: 更新时间
- `is_deleted`: 软删除标记

---

## 快速查找索引

### 按字母顺序的英文字段

- category_id → 分类 id
- created_at → 创建时间
- currency_type → 货币类型
- exchange_rate → 汇率
- image_url → 图片 url / 照片
- inventory_id → 在库 id
- is_deleted → 软删除标记
- name → 分类名 / 渠道名 / 品名
- notes → 备注
- order_id → 订单 id
- order_no → 订单编号
- other_cost → 其他成本
- purchase_amount → 进货支出(日元)
- purchase_amount_cny → 进货支出(人民币)
- purchase_date → 进货日期
- purchase_amount → 进货支出
- purchase_date → 进货日期
- purchase_id → 进货 id
- purchase_no → 进货单号
- purchase_quantity → 进货数量
- quantity → 数量
- revenue → 收入金额
- shipping_fee → 运费
- stock_quantity → 在库数量
- subtotal_cost → 小计成本
- supplier_id → 进货渠道 id
- total_amount → 支出
- total_cost → 成本
- transaction_time → 交易时间
- unit_cost → 单件成本
- unit_price → 出库单价
- updated_at → 更新时间
